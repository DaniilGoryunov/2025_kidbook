import os
from pathlib import Path
from gigachat import GigaChat
from langchain_core.prompts import PromptTemplate


CONCEPTS_DIR = Path(os.getenv("CONCEPTS_DIR"))

CONCEPTS = [
    "Массовые_открытые_онлайн-курсы_(MOOC)", "Онлайн-курсы_с_сертификатами", "Геймифицированные_платформы",
    "Образовательные_мобильные_приложения", "Подкасты", "Обучение_через_YouTube", "Электронные_книги_и_статьи",
    "Образовательные_блоги", "Интерактивные_симуляции", "Совместное_обучение", "Онлайн-наставничество_и_коучинг",
    "Вебинары", "Форумы_и_сообщества", "Социальные_сети", "Виртуальные_конференции_и_саммиты",
    "Как_узнавать_новое_Онлайн", "Обучающие_платформы", "Учебные_материалы", "Интерактивное_и_практическое_обучение",
    "Сообщества_и_мероприятия"
]

CONCEPTS_DIR.mkdir(parents=True, exist_ok=True)

def makeFile(item, content):
    filepath = CONCEPTS_DIR / f"{item}.md"
    filepath.write_text(content, encoding="utf-8")

def getTemplate(item):
    return PromptTemplate(
        input_variables=['query'],
        template="""
        Представь, что ты опытный педагог и писатель, создающий детскую энциклопедию о способах изучения нового онлайн. Твоя задача – написать захватывающую, познавательную и понятную статью по заданной теме. Учитывай, что читатели – любознательные дети 8-12 лет, которым важно объяснить сложные вещи простым и увлекательным языком. Основные понятия:
        Как узнавать новое Онлайн, 
        Обучающие платформы,
        Учебные материалы,
        Интерактивное и практическое обучение,
        Сообщества и мероприятия,
        Массовые открытые онлайн-курсы (MOOC), Онлайн-курсы с сертификатами, Геймифицированные платформы, 
        Образовательные мобильные приложения, Подкасты, Обучение через YouTube, Электронные книги и статьи, 
        Образовательные блоги, Интерактивные симуляции, Совместное обучение, Онлайн-наставничество и коучинг, 
        Вебинары, Форумы и сообщества, Социальные сети, Виртуальные конференции и саммиты.
        Структура статьи:
        1. **Заголовок** – яркий и привлекающий внимание.
        2. **Введение** – краткое и интересное объяснение, почему этот способ обучения полезен.
        3. **Что это такое?** – определение понятия простыми словами.
        4. **Как это работает?** – объяснение с примерами из реальной жизни.
        5. **Где это используют?** – упоминание популярных платформ, сервисов или инструментов.
        6. **Почему это круто?** – список преимуществ, которые вдохновят ребёнка попробовать этот способ обучения.
        7. **Есть ли сложности?** – возможные трудности и советы, как с ними справиться.
        8. **Занимательные факты** – интересные детали, которые сделают статью увлекательнее.
        9. **Вывод** – небольшой итог с ключевыми мыслями.
        
        Требования:
        - Страница "Как узнавать новое Онлайн" должна быть написана как основная и общая.
        - Используй **жирный шрифт** для ключевых терминов и эмодзи, чтобы привлечь внимание.
        - Приводи примеры из жизни, которые помогут детям легко понять материал.
        - Для всех терминов делай сноски с определениями.
        - Старайся делать структурированно.
        - Добавляй вопросы, чтобы побудить читателя задуматься и захотеть узнать больше.
        - Оставляй небольшие "советы эксперта", чтобы мотивировать детей на самостоятельное изучение.
        
        Понятие: {query}
        """
    ).format(query=item)

def main():
    giga_chat_key = os.getenv("GIGA_CHAT_KEY") 
    model = GigaChat(
        credentials=giga_chat_key,
        verify_ssl_certs=False,
        model='GigaChat-2-Max',
        timeout=30
    )
    for item in CONCEPTS:
        prompt = getTemplate(item)
        response = model.chat(prompt)
        makeFile(item, response.choices[0].message.content)

if __name__ == "__main__":
    main()
